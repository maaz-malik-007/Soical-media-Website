<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SociaLite - Sign In</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the responsive main area */
        .main-content {
            flex-grow: 1;
        }
        /* Ensure the dropdown doesn't cause layout shift */
        #auth-menu {
            transform-origin: top right;
            animation: fadeIn 0.15s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95) translateY(-5px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans bg-gray-50">


    <!-- 
        ================================================================
        1. NAVBAR - Fixed, Responsive Header
        ================================================================
    -->
    <nav class="w-full sticky top-0 z-50 bg-white shadow-lg border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <span class="text-2xl font-extrabold text-indigo-600 tracking-tight">SociaLite</span>
                </div>

                <!-- Desktop Links -->
                <div class="hidden sm:ml-6 sm:flex sm:space-x-4">
                    <a href="../index.html" class="text-gray-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150">Home</a>
                    <a href="./Notification.html" class="text-gray-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150">Notifications</a>
                    <a href="./Setting.html" class="text-gray-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150">Settings</a>
                </div>

                <!-- Auth/Menu Toggle -->
                <div class="flex items-center space-x-4">
                    <button id="post-button" onclick="window.showStatusMessage('Ready to create post!', 'success', 3000)" class="hidden sm:inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-full shadow-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                        <span class="mr-1">+</span> Create Post
                    </button>
                    
                    <div class="relative inline-block text-left">
                        <!-- Dynamic Auth Button / Toggle -->
                        <button type="button" class="inline-flex justify-center items-center rounded-full border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none transition duration-150" aria-expanded="false" aria-haspopup="true">
                            Loading Auth...
                            <svg id="auth-arrow" class="-mr-1 ml-2 h-5 w-5 transition-transform duration-150" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        
                        <!-- Dropdown menu (Visible only when not signed in) -->
                        <div id="auth-menu" class="origin-top-right absolute right-0 mt-2 w-48 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden" role="menu" aria-orientation="vertical" aria-labelledby="auth-status-button">
                            <div class="py-1" role="none">
                                <a href="./Login.html" class="text-indigo-600 font-semibold block px-4 py-2 text-sm hover:bg-indigo-50 transition duration-100" role="menuitem">Login</a>
                                <a href="./Signup.html" class="text-gray-700 block px-4 py-2 text-sm hover:bg-indigo-50 hover:text-indigo-600 transition duration-100" role="menuitem">Signup</a>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Menu Button -->
                    <button type="button" class="sm:hidden text-gray-500 hover:text-gray-900" id="mobile-menu-button" aria-expanded="false">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu (Hidden by default) -->
        <div class="sm:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="../index.html" onclick="window.showStatusMessage('Navigating to Home (Mock)', 'info', 2000)" class="text-gray-900 block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100">Home</a>
                <a href="./Notification.html" onclick="window.showStatusMessage('Navigating to Notifications (Mock)', 'info', 2000)" class="text-gray-500 block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100">Notifications</a>
                <a href="./Setting.html" onclick="window.showStatusMessage('Navigating to Settings (Mock)', 'info', 2000)" class="text-gray-500 block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-100">Settings</a>
                <button id="mobile-post-button" onclick="window.showStatusMessage('Ready to create post!', 'success', 3000)" class="w-full text-left text-white bg-indigo-600 hover:bg-indigo-700 block px-3 py-2 rounded-md text-base font-medium transition duration-150 mt-2">
                    <span class="mr-1">+</span> Create Post
                </button>
            </div>
        </div>
    </nav>


    <!-- 
        ================================================================
        2. MAIN CONTENT - Centered Card Area
        ================================================================
    -->
    <main class="main-content flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-md bg-white rounded-2xl shadow-2xl p-8 sm:p-10 border border-indigo-100 transition-all duration-300">
            
            <div class="text-center mb-8">
                <span class="text-4xl font-extrabold text-indigo-600 tracking-tight block mb-1">SociaLite</span>
                <h1 class="text-xl font-semibold text-gray-800 mt-2">Sign In to Your Account</h1>
            </div>
            
            <!-- Status Message Area -->
            <div id="status-message" class="hidden p-3 mb-6 text-sm rounded-lg" role="alert"></div>

            <!-- 
                ============================================================
                3. LOGIN FORM (MOCK SUBMISSION)
                ============================================================
            -->
            <form id="login-form" class="space-y-6">

                <!-- Email Input -->
                <div>
                    <label for="login-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                    <input type="email" id="login-email" required placeholder="you@example.com" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-3 border" autocomplete="email">
                </div>

                <!-- Password Input -->
                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="login-password" required placeholder="Enter your password" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-3 border" autocomplete="current-password">
                </div>
                
                <!-- Forgot Password Link -->
                <div class="flex justify-end">
                    <div class="text-sm">
                        <a href="javascript:void(0)" class="font-medium text-indigo-600 hover:text-indigo-800 transition duration-150" onclick="window.showStatusMessage('Password reset link sent (mock).', 'info', 4000); return false;">
                            Forgot your password?
                        </a>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="login-submit-button" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-xl shadow-lg text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                    Sign In
                </button>
            </form>

            <!-- 
                ============================================================
                4. FOOTER LINK
                ============================================================
            -->
            <div class="mt-8 text-center text-sm text-gray-600">
                <p>
                    Don't have an account? 
                    <a href="./Login.html" onclick="window.showStatusMessage('Navigating to Signup (Mock)', 'info', 2000)" class="font-medium text-indigo-600 hover:text-indigo-800 transition duration-150">
                        Sign Up
                    </a>
                </p>
            </div>
        </div>
    </main>

    <!-- 
        ================================================================
        5. JAVASCRIPT LOGIC (INCLUDING FIREBASE INITIALIZATION AND MOCK LOGIN)
        ================================================================
    -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Use Debug logging for development
        setLogLevel('Debug'); 

        // --- Global Variables (Provided by Canvas Environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-socialite-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, auth;
        let currentUserId = null;
        let isDropdownOpen = false; // State for dropdown

        // --- DOM Elements ---
        const loginForm = document.getElementById('login-form');
        const statusMessage = document.getElementById('status-message');
        const authButton = document.getElementById('auth-status-button');
        const authMenu = document.getElementById('auth-menu');
        const authArrow = document.getElementById('auth-arrow');
        const mobileMenu = document.getElementById('mobile-menu');
        
        // --- Utility Functions ---

        /**
         * Displays a temporary status message (success, error, or info).
         * Exposed globally for inline event handlers (e.g., onclick).
         */
        function showStatusMessage(message, type, duration = 3000) {
            // Clear previous classes
            statusMessage.className = '';
            statusMessage.classList.add('p-3', 'mb-6', 'text-sm', 'rounded-lg');

            if (type === 'success') {
                statusMessage.classList.add('bg-green-100', 'text-green-700', 'border', 'border-green-300');
            } else if (type === 'error') {
                statusMessage.classList.add('bg-red-100', 'text-red-700', 'border', 'border-red-300');
            } else if (type === 'info') {
                statusMessage.classList.add('bg-indigo-100', 'text-indigo-700', 'border', 'border-indigo-300');
            }
            
            statusMessage.innerHTML = message;
            statusMessage.classList.remove('hidden');

            setTimeout(() => {
                statusMessage.classList.add('hidden');
            }, duration);
        }
        
        // Expose function globally for use in HTML inline event handlers
        window.showStatusMessage = showStatusMessage;

        /**
         * Toggles the mobile navigation menu.
         */
        function toggleMobileMenu() {
            mobileMenu.classList.toggle('hidden');
        }

        /**
         * Toggles the visibility of the authentication dropdown menu.
         * Only applicable when the user is NOT signed in.
         */
        function toggleAuthMenu() {
            isDropdownOpen = !isDropdownOpen;
            authMenu.classList.toggle('hidden', !isDropdownOpen);
            authArrow.classList.toggle('rotate-180', isDropdownOpen);
            authButton.setAttribute('aria-expanded', isDropdownOpen);
        }

        /**
         * Handles the click on the authentication button (Sign Out or Toggle Dropdown).
         */
        async function handleAuthToggle() {
            if (!auth) {
                console.error("Firebase Auth not initialized.");
                return;
            }

            if (auth.currentUser) {
                // If signed in, execute sign out
                authButton.disabled = true;
                authButton.textContent = 'Signing Out...';
                try {
                    await signOut(auth);
                    console.log("User signed out successfully.");
                    showStatusMessage('You have been signed out. Thanks for visiting!', 'info', 3000);
                } catch (error) {
                    console.error("Sign Out failed:", error);
                    showStatusMessage(`Sign Out failed: ${error.message}`, 'error', 5000);
                } finally {
                    authButton.disabled = false;
                }
            } else {
                // If signed out (guest), toggle the menu
                toggleAuthMenu();
            }
        }


        // --- Firebase Initialization and Authentication ---

        /**
         * Initializes Firebase and authenticates the user.
         */
        async function initFirebaseAndAuth() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    throw new Error("Firebase config is missing.");
                }

                app = initializeApp(firebaseConfig);
                auth = getAuth(app);

                // Initial sign-in attempt
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Set up Auth State Listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        // State: Signed In
                        authButton.textContent = 'Sign Out';
                        authButton.classList.remove('text-gray-700', 'hover:bg-gray-50');
                        authButton.classList.add('bg-indigo-500', 'text-white', 'hover:bg-indigo-600');
                        authArrow.classList.add('hidden'); // Hide arrow for direct action button
                        authMenu.classList.add('hidden'); // Ensure dropdown is closed
                        isDropdownOpen = false;
                    } else {
                        currentUserId = null;
                        // State: Signed Out (Guest)
                        authButton.textContent = 'Login / Signup';
                        authButton.classList.remove('bg-indigo-500', 'text-white', 'hover:bg-indigo-600');
                        authButton.classList.add('text-gray-700', 'hover:bg-gray-50');
                        authArrow.classList.remove('hidden'); // Show arrow for dropdown
                    }
                });

            } catch (error) {
                console.error("Firebase/Auth Initialization Error:", error);
                authButton.textContent = 'Auth Failed';
                authButton.classList.add('bg-red-500', 'text-white');
            }
        }
        
        // --- Form Submission Handler (MOCK) ---

        /**
         * Handles the mock Login process.
         */
        function handleLogin(e) {
            e.preventDefault();
            const submitButton = document.getElementById('login-submit-button');
            submitButton.disabled = true;
            submitButton.textContent = 'Signing In...';

            const email = document.getElementById('login-email').value.trim();
            // In a real app, we would validate password and call Firebase sign-in methods here.
            
            // Simulating a network delay for the login process
            setTimeout(() => {
                // Mock logic: allow login only for 'user@test.com'
                if (email === 'user@test.com') {
                    showStatusMessage(`Success! Welcome back, user@test.com. (Mock Login)`, 'success', 5000);
                    // Clear password field only
                    document.getElementById('login-password').value = ''; 
                } else if (email.includes('fail')) {
                     showStatusMessage('Login failed: Invalid email or password.', 'error', 5000);
                } else {
                    showStatusMessage('Login failed: User not found or incorrect credentials.', 'error', 5000);
                }
                
                submitButton.disabled = false;
                submitButton.textContent = 'Sign In';

            }, 1500); // 1.5 second mock delay
        }

        // --- Initialization ---
        window.onload = function() {
            // Attach static event listeners
            document.getElementById('mobile-menu-button').onclick = toggleMobileMenu;
            authButton.onclick = handleAuthToggle;
            loginForm.onsubmit = handleLogin;
            
            // Start Firebase initialization
            initFirebaseAndAuth(); 
        };
    </script>
</body>
</html>